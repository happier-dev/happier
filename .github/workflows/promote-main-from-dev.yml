name: PROMOTE — Main from Dev

on:
  workflow_dispatch:
    inputs:
      mode:
        description: "Promotion — Mode"
        required: true
        type: choice
        default: fast_forward
        options:
          - fast_forward
          - reset
      dry_run:
        description: "Safety — Only compute and show what would change (no push)"
        required: true
        default: false
        type: boolean
      allow_reset:
        description: "Safety — Required when mode=reset (rewrites main history)"
        required: true
        default: false
        type: boolean
      confirm:
        description: "Confirm — Choose the exact action (mobile-friendly)"
        required: true
        type: choice
        options:
          - promote main from dev
          - reset main from dev

permissions:
  contents: read

concurrency:
  group: promote-main-from-dev
  cancel-in-progress: false

jobs:
  promote:
    uses: ./.github/workflows/promote-branch.yml
    secrets: inherit
    with:
      source: dev
      target: main
      mode: ${{ inputs.mode }}
      dry_run: ${{ inputs.dry_run }}
      allow_reset: ${{ inputs.allow_reset }}
      confirm: ${{ inputs.confirm }}
