# hapsta environment (template)
#
# Copy to `.env` (recommended) and adjust as needed:
#
#   cp .env.example .env
#
# Notes:
# - `HAPPIER_STACK_*` is the canonical prefix.
# - No legacy env aliases are supported.

# -----------------------------------------------------------------------------
# Core (server)
# -----------------------------------------------------------------------------

# Main server URL shown/used by the CLI (QR/login links, etc).
# For local use: http://localhost:3005
# For Tailscale (recommended): set this to your HTTPS Serve URL, e.g. https://<machine>.<tailnet>.ts.net
HAPPIER_STACK_SERVER_URL=http://localhost:3005

# Server port (main stack)
HAPPIER_STACK_SERVER_PORT=3005

# Which server component to use by default:
# - happy-server-light (default)
# - happy-server
HAPPIER_STACK_SERVER_COMPONENT=happy-server-light

# -----------------------------------------------------------------------------
# Full server (happy-server) managed infra (Docker Compose)
# -----------------------------------------------------------------------------
#
# When running `happy-server`, hapsta can auto-start per-stack Postgres/Redis/Minio
# (local, free, S3-compatible; no AWS required) and wire DATABASE_URL/REDIS_URL/S3_*.
#
# Disable if you want to bring your own Postgres/Redis/S3:
# HAPPIER_STACK_MANAGED_INFRA=0
#
# Auto-apply Prisma migrations for happy-server on `hapsta dev/start` (non-interactive, idempotent):
# - runs: `prisma migrate deploy`
HAPPIER_STACK_PRISMA_MIGRATE=1
#
# If autostart is enabled and Docker Desktop may start slowly, hapsta will wait for Docker.
# Default: 0ms in TTY sessions, 60000ms in non-interactive (LaunchAgent/SwiftBar).
# HAPPIER_STACK_DOCKER_WAIT_MS=60000
#
# Best-effort: try to start Docker automatically if it's installed but not running.
# Default: enabled in non-interactive (services), disabled in interactive shells.
# HAPPIER_STACK_DOCKER_AUTOSTART=1
# Optional macOS override:
# HAPPIER_STACK_DOCKER_APP=/Applications/Docker.app
#
# happy-server runs behind a local gateway on the main stack port. The real backend server will
# bind to this port (stack-scoped env overrides will be written automatically for stacks):
# HAPPIER_STACK_HAPPY_SERVER_BACKEND_PORT=3015

# -----------------------------------------------------------------------------
# Server-light (happy-server-light) Prisma behavior
# -----------------------------------------------------------------------------
#
# In `hapsta dev` and `hapsta start`, happy-server-light uses deterministic Prisma migrations:
# - `prisma migrate deploy --schema prisma/sqlite/schema.prisma`
#
# Historical note:
# - Old server-light setups used `prisma db push`. Hapsta no longer uses db push for SQLite.
# - If you have an old SQLite DB created via db push, you may need to baseline it once so migrations can run.

# -----------------------------------------------------------------------------
# Expo / Metro dev server behavior (UI)
# -----------------------------------------------------------------------------
#
# In `hapsta dev`, `hapsta start --mobile`, and `hapsta mobile`, hapsta starts `expo start`.
# IMPORTANT: we enforce a single Expo dev server per stack/worktree (no separate "web" vs "mobile"
# Metro processes for the same stack).
#
# Expo host mode:
# - We default to LAN so phones can reach Metro on your Wiâ€‘Fi network.
# - Web UI still uses the stack-scoped `happy-<stack>.localhost` hostname for isolation.
#
# Allowed: lan | localhost | tunnel
# HAPPIER_STACK_EXPO_HOST=lan
#
# Optional: force the Expo dev server port (otherwise we auto-pick a free port).
# HAPPIER_STACK_EXPO_DEV_PORT=8081
#
# Default dev-client URL scheme used by Hapsta when running `--mobile`.
# This should match the scheme used by the installed dev-client app.
# HAPPIER_STACK_DEV_CLIENT_SCHEME=hapsta-dev
#
# Optional: override LAN IP detection (used to rewrite localhost server URLs for mobile).
# HAPPIER_STACK_LAN_IP=192.168.0.50
#
# Optional: storage isolation scope for native dev-client.
#
# When using a single installed dev-client app across multiple stacks, you can scope the app's
# persisted storage (SecureStore/MMKV) per stack to avoid token/server collisions.
#
# - If set, hapsta passes it through as `EXPO_PUBLIC_HAPPY_STORAGE_SCOPE`.
# - If unset, and you run stack-mode dev-client (`--mobile`), hapsta defaults it to the stack name.
#
# HAPPIER_STACK_STORAGE_SCOPE=pr272-107-fixes-2026-01-15
#
# To avoid cross-worktree Metro cache pollution in non-interactive runs (LLMs/services),
# we default to adding `--clear` when no TTY is present.
#
# - Set to 0 to never pass `--clear`
# - Set to 1 to always pass `--clear`
# HAPPIER_STACK_EXPO_CLEAR_CACHE=1

# -----------------------------------------------------------------------------
# What to run
# -----------------------------------------------------------------------------

# UI build + serving (when using happy-server-light)
HAPPIER_STACK_UI_PREFIX=/
HAPPIER_STACK_SERVE_UI=1

# Components
HAPPIER_STACK_UI=1
HAPPIER_STACK_DAEMON=1

# Setup behavior (bootstrap)
HAPPIER_STACK_NPM_LINK=1
HAPPIER_STACK_CLI_BUILD=1

# Init behavior
# - Set to 1 to persist skipping runtime installs when running `hapsta init`.
#   (Useful on dev machines where you always run from your repo checkout via HAPPIER_STACK_CLI_ROOT_DIR.)
# HAPPIER_STACK_INIT_NO_RUNTIME=1

# -----------------------------------------------------------------------------
# Storage / paths
# -----------------------------------------------------------------------------

# Canonical storage root for stacks:
HAPPIER_STACK_STORAGE_DIR=~/.happier/stacks

# Optional overrides for the main stack:
HAPPIER_STACK_UI_BUILD_DIR=~/.happier/stacks/main/ui
HAPPIER_STACK_CLI_HOME_DIR=~/.happier/stacks/main/cli

# When creating new stacks, auto-pick ports starting from here:
HAPPIER_STACK_STACK_PORT_START=3005

# -----------------------------------------------------------------------------
# Git cloning defaults (bootstrap)
# -----------------------------------------------------------------------------

# Default clone source for missing monorepo checkout:
# - forks
# - upstream
HAPPIER_STACK_REPO_SOURCE=upstream

# Optional: override the monorepo repo URL (clone source)
# HAPPIER_STACK_REPO_URL=

# Disable auto-cloning missing monorepo checkout:
# HAPPIER_STACK_CLONE_MISSING=0

# -----------------------------------------------------------------------------
# Tailscale Serve automation (optional)
# -----------------------------------------------------------------------------

# Optional: expose UI over HTTPS using Tailscale Serve (recommended for remote access)
HAPPIER_STACK_TAILSCALE_SERVE=0
HAPPIER_STACK_TAILSCALE_SERVE_PATH=/
HAPPIER_STACK_TAILSCALE_UPSTREAM=http://127.0.0.1:3005
HAPPIER_STACK_TAILSCALE_RESET_ON_EXIT=0
HAPPIER_STACK_TAILSCALE_PREFER_PUBLIC_URL=1

# Optional: how long `hapsta start` should wait for Tailscale at boot (ms)
HAPPIER_STACK_TAILSCALE_WAIT_MS=15000

# If `tailscale` is not on PATH (common if you use the macOS app), set this:
HAPPIER_STACK_TAILSCALE_BIN=/Applications/Tailscale.app/Contents/MacOS/Tailscale

# -----------------------------------------------------------------------------
# Worktree UX (optional)
# -----------------------------------------------------------------------------

# Preferred terminal / shell for `hapsta wt shell` and SwiftBar actions:
# HAPPIER_STACK_WT_TERMINAL=auto
# HAPPIER_STACK_WT_SHELL=/bin/zsh

# -----------------------------------------------------------------------------
# Tauri build (optional)
# -----------------------------------------------------------------------------

HAPPIER_STACK_BUILD_TAURI=0
HAPPIER_STACK_TAURI_DEBUG=1
HAPPIER_STACK_TAURI_IDENTIFIER=com.happier.stack
HAPPIER_STACK_TAURI_PRODUCT_NAME="Hapsta"

# Optional overrides:
# HAPPIER_STACK_TAURI_SERVER_URL=
# HAPPIER_STACK_TAURI_PREFER_TAILSCALE=1

# -----------------------------------------------------------------------------
# Mobile app (iOS) (optional)
# -----------------------------------------------------------------------------
#
# These are used by `hapsta mobile ...` commands.
# Recommended if you plan to install a release build onto a real iPhone.
#
# - For real devices: use a bundle identifier you own (Apple dev portal).
# - `HAPPIER_STACK_SERVER_URL` is automatically baked into the app as EXPO_PUBLIC_HAPPY_SERVER_URL when building.
#
# Example:
# HAPPIER_STACK_IOS_BUNDLE_ID=com.yourname.hapsta.dev
# HAPPIER_STACK_IOS_APP_NAME="Hapsta"
#
# Optional: override how Metro is started / which scheme is used for QR launching:
# HAPPIER_STACK_MOBILE_HOST=lan
# HAPPIER_STACK_MOBILE_SCHEME=com.yourname.hapsta.dev
#
# Port note:
# - Preferred: HAPPIER_STACK_EXPO_DEV_PORT
# HAPPIER_STACK_EXPO_DEV_PORT=8081

# -----------------------------------------------------------------------------
# Optional: server-light metrics (upstream component feature; not used by hapsta scripts)
# -----------------------------------------------------------------------------

METRICS_ENABLED=false
METRICS_PORT=9090
